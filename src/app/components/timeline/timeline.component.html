<div class="timeline-container">
  <!-- Scroll to Today Button (only show when more than 1 month away) -->
  <button
    *ngIf="showScrollToToday()"
    mat-fab
    class="today-button"
    (click)="scrollToToday()"
    aria-label="Scroll to today">
    <mat-icon>today</mat-icon>
  </button>

  <!-- Virtual Scroll Viewport -->
  <cdk-virtual-scroll-viewport
    itemSize="60"
    class="timeline-viewport"
    (scrolledIndexChange)="onScroll()">

    <div *cdkVirtualFor="let timelineDate of timelineDates(); trackBy: trackByDateKey"
         class="timeline-item">

      <!-- Date Row -->
      <div class="date-row"
           [class.today]="isToday(timelineDate.dateKey)"
           [matTooltip]="getBalanceTooltip(timelineDate.date)"
           [matTooltipClass]="getBalanceTooltipClass(timelineDate.date)"
           matTooltipPosition="left">
        <!-- Date Label -->
        <div class="date-label">
          {{ timelineDate.displayDate }}
        </div>

        <!-- Connector Column -->
        <div class="connector-column">
          <div class="connector-line"></div>
        </div>

        <!-- Entries Column -->
        <div class="entries-column">
          <!-- Show entries if any exist -->
          <div *ngIf="timelineDate.entries.length > 0" class="entries-list">
            <div *ngFor="let occurrence of timelineDate.entries; let last = last"
                 class="entry-item"
                 [class.income]="occurrence.entry.type === 'income'"
                 [class.expense]="occurrence.entry.type === 'expense'"
                 (click)="onEntryClick(occurrence.entry, occurrence.date)">

              <div class="entry-connector">──</div>
              <div class="entry-label">{{ occurrence.entry.label }}</div>
              <div class="entry-amount">
                {{ formatAmount(occurrence.entry) }}
              </div>
            </div>
          </div>

          <!-- Show empty state if no entries -->
          <div *ngIf="timelineDate.entries.length === 0" class="no-entries">
            <div class="empty-connector">│</div>
          </div>
        </div>
      </div>

      <!-- Month-End Balance Row -->
      <div *ngIf="timelineDate.isMonthEnd" class="month-end-balance-row">
        <div class="month-end-label">
          Balance as of {{ formatMonthEndDate(timelineDate.date) }}
        </div>
        <div class="month-end-amount"
             [class.positive]="getBalanceForDate(timelineDate.date) >= 0"
             [class.negative]="getBalanceForDate(timelineDate.date) < 0">
          {{ formatCurrency(getBalanceForDate(timelineDate.date)) }}
        </div>
      </div>

      <!-- Month Header (shown after month-end balance) -->
      <div *ngIf="timelineDate.isMonthEnd" class="month-header">
        {{ timelineDate.nextMonthYear }}
      </div>
    </div>

  </cdk-virtual-scroll-viewport>
</div>
